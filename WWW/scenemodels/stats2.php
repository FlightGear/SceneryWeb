<?php include 'inc/header.php';

$co_array['Russian Federation']='16995800';
$co_array['Antarctica']='14000000';
$co_array['China']='9326410';
$co_array['United States']='9161923';
$co_array['Canada']='9093507';
$co_array['Brazil']='8456510';
$co_array['Australia']='7617930';
$co_array['India']='2973190';
$co_array['Argentina']='2736690';
$co_array['Kazakhstan']='2669800';
$co_array['Algeria']='2381740';
$co_array['Sudan']='2376000';
$co_array['Congo, Democratic Republic of the']='2267600';
$co_array['Greenland']='2166086';
$co_array['Saudi Arabia']='2149690';
$co_array['Mexico']='1923040';
$co_array['Indonesia']='1826440';
$co_array['Libya']='1759540';
$co_array['Iran']='1636000';
$co_array['Peru']='1280000';
$co_array['Niger']='1266700';
$co_array['Chad']='1259200';
$co_array['Angola']='1246700';
$co_array['Mali']='1220000';
$co_array['South Africa']='1219912';
$co_array['Ethiopia']='1119683';
$co_array['Bolivia']='1084390';
$co_array['Colombia']='1038700';
$co_array['Mauritania']='1030400';
$co_array['Egypt']='995450';
$co_array['Nigeria']='910768';
$co_array['Tanzania']='886037';
$co_array['Venezuela']='882050';
$co_array['Namibia']='825418';
$co_array['Mozambique']='784090';
$co_array['Pakistan']='778720';
$co_array['Turkey']='770760';
$co_array['Chile']='748800';
$co_array['Zambia']='740724';
$co_array['Burma']='657740';
$co_array['Afghanistan']='647500';
$co_array['France']='640053';
$co_array['Somalia']='627337';
$co_array['Central African Republic']='622984';
$co_array['Ukraine']='603700';
$co_array['Botswana']='585370';
$co_array['Madagascar']='581540';
$co_array['Kenya']='569250';
$co_array['Yemen']='527970';
$co_array['Thailand']='511770';
$co_array['Spain']='499542';
$co_array['Turkmenistan']='488100';
$co_array['Cameroon']='469440';
$co_array['Papua New Guinea']='452860';
$co_array['Morocco']='446300';
$co_array['Iraq']='432162';
$co_array['Uzbekistan']='425400';
$co_array['Sweden']='410934';
$co_array['Paraguay']='397300';
$co_array['Zimbabwe']='386670';
$co_array['Japan']='374744';
$co_array['Germany']='349223';
$co_array['Congo, Republic of the']='341500';
$co_array['Malaysia']='328550';
$co_array['Vietnam']='325360';
$co_array['Cote d Ivoire']='318000';
$co_array['Norway']='307442';
$co_array['Finland']='304473';
$co_array['Poland']='304465';
$co_array['Philippines']='298170';
$co_array['Italy']='294020';
$co_array['Ecuador']='276840';
$co_array['Burkina Faso']='273800';
$co_array['New Zealand']='268021';
$co_array['Western Sahara']='266000';
$co_array['Gabon']='257667';
$co_array['Guinea']='245857';
$co_array['United Kingdom']='241590';
$co_array['Ghana']='230940';
$co_array['Laos']='230800';
$co_array['Romania']='230340';
$co_array['Oman']='212460';
$co_array['Belarus']='207600';
$co_array['Uganda']='199710';
$co_array['Guyana']='196850';
$co_array['Senegal']='192000';
$co_array['Kyrgyzstan']='191300';
$co_array['Syria']='184050';
$co_array['Cambodia']='176520';
$co_array['Uruguay']='173620';
$co_array['Suriname']='161470';
$co_array['Tunisia']='155360';
$co_array['Nepal']='143181';
$co_array['Tajikistan']='142700';
$co_array['Bangladesh']='133910';
$co_array['Greece']='130800';
$co_array['Eritrea']='121320';
$co_array['Korea, North']='120410';
$co_array['Nicaragua']='120254';
$co_array['Honduras']='111890';
$co_array['Cuba']='110860';
$co_array['Benin']='110620';
$co_array['Bulgaria']='110550';
$co_array['Guatemala']='108430';
$co_array['Serbia and Montenegro']='102136';
$co_array['Iceland']='100250';
$co_array['Korea, South']='98190';
$co_array['Liberia']='96320';
$co_array['Malawi']='94080';
$co_array['Hungary']='92340';
$co_array['Jordan']='91971';
$co_array['Portugal']='91951';
$co_array['French Guiana']='89150';
$co_array['Azerbaijan']='86100';
$co_array['United Arab Emirates']='83600';
$co_array['Austria']='82444';
$co_array['Czech Republic']='77276';
$co_array['Panama']='75990';
$co_array['Sierra Leone']='71620';
$co_array['Georgia']='69700';
$co_array['Ireland']='68890';
$co_array['Sri Lanka']='64740';
$co_array['Latvia']='63589';
$co_array['Svalbard']='61020';
$co_array['Croatia']='56414';
$co_array['Togo']='54385';
$co_array['Bosnia and Herzegovina']='51129';
$co_array['Costa Rica']='50660';
$co_array['Slovakia']='48800';
$co_array['Dominican Republic']='48380';
$co_array['Bhutan']='47000';
$co_array['Estonia']='43211';
$co_array['Denmark']='42394';
$co_array['Switzerland']='39770';
$co_array['Netherlands']='33883';
$co_array['Moldova']='33371';
$co_array['Taiwan']='32260';
$co_array['Lesotho']='30355';
$co_array['Belgium']='30278';
$co_array['Armenia']='28400';
$co_array['Equatorial Guinea']='28051';
$co_array['Guinea-Bissau']='28000';
$co_array['Haiti']='27560';
$co_array['Solomon Islands']='27540';
$co_array['Albania']='27398';
$co_array['Burundi']='25650';
$co_array['Rwanda']='24948';
$co_array['Macedonia']='24856';
$co_array['Djibouti']='22980';
$co_array['Belize']='22806';
$co_array['El Salvador']='20720';
$co_array['Israel']='20330';
$co_array['Slovenia']='20151';
$co_array['New Caledonia']='18575';
$co_array['Fiji']='18270';
$co_array['Kuwait']='17820';
$co_array['Swaziland']='17203';
$co_array['Vanuatu']='12200';
$co_array['Falkland Islands (Islas Malvinas)']='12173';
$co_array['Qatar']='11437';
$co_array['Jamaica']='10831';
$co_array['Lebanon']='10230';
$co_array['Bahamas, The']='10070';
$co_array['Gambia, The']='10000';
$co_array['Cyprus']='9240';
$co_array['Puerto Rico']='8870';
$co_array['West Bank']='5640';
$co_array['Brunei']='5270';
$co_array['Trinidad and Tobago']='5128';
$co_array['Cape Verde']='4033';
$co_array['South Georgia and the South Sandwich Islands']='3903';
$co_array['French Polynesia']='3660';
$co_array['Samoa']='2934';
$co_array['Luxembourg']='2586';
$co_array['Reunion']='2507';
$co_array['Comoros']='2170';
$co_array['Mauritius']='2030';
$co_array['Guadeloupe']='1706';
$co_array['Faroe Islands']='1399';
$co_array['Martinique']='1060';
$co_array['Hong Kong']='1042';
$co_array['Sao Tome and Principe']='1001';
$co_array['Netherlands Antilles']='960';
$co_array['Kiribati']='811';
$co_array['Dominica']='754';
$co_array['Tonga']='718';
$co_array['Micronesia, Federated States of']='702';
$co_array['Singapore']='682.7';
$co_array['Bahrain']='665';
$co_array['Saint Lucia']='606';
$co_array['Isle of Man']='572';
$co_array['Guam']='541.3';
$co_array['Northern Mariana Islands']='477';
$co_array['Andorra']='468';
$co_array['Palau']='458';
$co_array['Seychelles']='455';
$co_array['Antigua and Barbuda']='442.6';
$co_array['Barbados']='431';
$co_array['Turks and Caicos Islands']='430';
$co_array['Heard Island and McDonald Islands']='412';
$co_array['Saint Vincent and the Grenadines']='389';
$co_array['Jan Mayen']='377';
$co_array['Mayotte']='374';
$co_array['Gaza Strip']='360';
$co_array['Virgin Islands']='346';
$co_array['Grenada']='344';
$co_array['Malta']='316';
$co_array['Maldives']='300';
$co_array['Wallis and Futuna']='274';
$co_array['Cayman Islands']='262';
$co_array['Saint Kitts and Nevis']='261';
$co_array['Niue']='260';
$co_array['Saint Pierre and Miquelon']='242';
$co_array['Cook Islands']='236.7';
$co_array['American Samoa']='199';
$co_array['Aruba']='193';
$co_array['Marshall Islands']='181.3';
$co_array['Liechtenstein']='160';
$co_array['British Virgin Islands']='153';
$co_array['Christmas Island']='135';
$co_array['Jersey']='116';
$co_array['Anguilla']='102';
$co_array['Montserrat']='102';
$co_array['Guernsey']='78';
$co_array['San Marino']='61.2';
$co_array['British Indian Ocean Territory']='60';
$co_array['Bermuda']='53.3';
$co_array['Bouvet Island']='49';
$co_array['Pitcairn Islands']='47';
$co_array['Norfolk Island']='34.6';
$co_array['Macau']='28.2';
$co_array['Europa Island']='28';
$co_array['Tuvalu']='26';
$co_array['Nauru']='21';
$co_array['Cocos (Keeling) Islands']='14';
$co_array['Tokelau']='10';
$co_array['Gibraltar']='6.5';
$co_array['Wake Island']='6.5';
$co_array['Clipperton Island']='6';
$co_array['Navassa Island']='5.4';
$co_array['Ashmore and Cartier Islands']='5';
$co_array['Glorioso Islands']='5';
$co_array['Spratly Islands']='5';
$co_array['Juan de Nova Island']='4.4';
$co_array['Coral Sea Islands']='3';
$co_array['Monaco']='1.95';
$co_array['Tromelin Island']='1';
$co_array['Vatican City State (Holy See)']='0.44';
$co_array['Bassas da India']='0.2';
$co_array['Akrotiri']='';
$co_array['Dhekelia']='';
$co_array['French Southern and Antarctic Lands']='';
$co_array['Lithuania']='NA';
$co_array['Mongolia']='';
$co_array['Paracel Islands']='NA';
$co_array['Saint Helena']='';
$co_array['Timor-Leste']='NA ';

?>
<script type='text/javascript' src='https://www.google.com/jsapi'></script>
<script type='text/javascript'>
 google.load('visualization', '1', {'packages': ['geochart','corechart']});
 google.setOnLoadCallback(drawRegionsMap);

  var regionId = 'world';
  var worldmap = 'data1';

  function drawRegionsMap() {
    if (arguments[0]!= 'auto' && arguments[0]) {
        regionId = arguments[0];
    }
    if (arguments[1] != 'auto' && arguments[1]) {
        worldmap = arguments[1];
    }
    var data1 = google.visualization.arrayToDataTable([
      ['Country', 'Object density'],
      <?php
        connect_sphere_r();
        $query = "SELECT count(ob_id) AS count, co_name, co_code ";
        $query.= "FROM fgs_objects, fgs_countries ";
        $query.= "WHERE ob_country=co_code ";
        $query.= "GROUP BY co_code, co_name ";
        $query.= "ORDER BY count DESC ";
        $result = pg_query($query);

        while ($row = pg_fetch_assoc($result)) {
            $country = $row[co_name];

            if ($row[count] > 0 and $co_array[$country] > 0) {
                echo "[\"".$country."\", ".round(($row[count]/$co_array[$country])*10000)."],\n ";
            }

        }
      ?>
    ]);
    var data2 = google.visualization.arrayToDataTable([
      ['Country', 'Objects'],
      <?php
      while ($row = pg_fetch_assoc($result)) {
            $country = $row[co_name];
            if ($row[count] > 0) {
                echo "['".$country."', ".$row[count]."],\n          ";
            }
        }
      ?>
    ]);

    var options = {
        backgroundColor: '#ADCDFF'
    };
    if (regionId != '[object Event]') {
        options['region'] = regionId;
    }
    var chart1 = new google.visualization.GeoChart(document.getElementById('chart1_div'));
    if (worldmap === "data2") {
        chart1.draw(data2, options);
    }
    if (worldmap === "data1") {
        chart1.draw(data1, options);
    }
};

  google.setOnLoadCallback(drawChart);
  function drawChart() {
    var dataPie = google.visualization.arrayToDataTable([
        ['Country', 'Objects'],
        <?php
        connect_sphere_r();
        $query = "SELECT count(ob_id) AS count, co_name, co_code ";
        $query.= "FROM fgs_objects, fgs_countries ";
        $query.= "WHERE ob_country=co_code ";
        $query.= "GROUP BY co_code, co_name ";
        $query.= "ORDER BY count DESC ";
        $query.= "LIMIT 20";
        $result = pg_query($query);

        while ($row = pg_fetch_assoc($result)) {
            echo "['".$row[co_name]."', ".$row[count]."],\n          ";
        }
        ?>
    ]);
    var dataPieAuthors = google.visualization.arrayToDataTable([
        ['Author', 'Objects'],
        <?php
        connect_sphere_r();
        $query = "SELECT count(mo_id) as count, au_name, au_id ";
        $query.= "FROM fgs_models,fgs_authors ";
        $query.= "WHERE mo_author=au_id ";
        $query.= "GROUP BY au_id,au_name ";
        $query.= "ORDER BY count DESC ";
        $result = pg_query($query);

        while ($row = pg_fetch_assoc($result)) {
            echo "['".$row[au_name]."', ".$row[count]."],\n          ";
        }
        ?>
    ]);

    var optionsPie = {
        chartArea: {height:"100%"},
        backgroundColor: 'none',
        pieSliceBorderColor: 'none',
        slices: {20: {color: '#ccc'}},
        legend: { alignment: 'center' }
    };

    var chartPie = new google.visualization.PieChart(document.getElementById('chart_pie_div'));
    google.visualization.events.addListener(chartPie, 'select', function () {
        // GeoChart selections return an array of objects with a row property; no column information
        var selection = chartPie.getSelection();
        dataPie.removeRow(selection[0].row);
        chartPie.draw(dataPie, optionsPie);
    });
    chartPie.draw(dataPie, optionsPie);

    var chartPieAuthors = new google.visualization.PieChart(document.getElementById('chart_pie_authors_div'));
    google.visualization.events.addListener(chartPieAuthors, 'select', function () {
        // GeoChart selections return an array of objects with a row property; no column information
        var selection = chartPieAuthors.getSelection();
        dataPieAuthors.removeRow(selection[0].row);
        chartPieAuthors.draw(dataPieAuthors, optionsPie);
    });
    chartPieAuthors.draw(dataPieAuthors, optionsPie);

};

google.setOnLoadCallback(drawBars);
function drawBars(sorting) {
    var dataBarCountry = google.visualization.arrayToDataTable([
      ['Country', 'Object density', 'Objects'],
      <?php
        connect_sphere_r();
        $query = "SELECT count(ob_id) AS count, co_name, co_code ";
        $query.= "FROM fgs_objects, fgs_countries ";
        $query.= "WHERE ob_country=co_code ";
        $query.= "GROUP BY co_code, co_name ";
        $query.= "ORDER BY count DESC ";
        $query.= "LIMIT 20 ";
        $result = pg_query($query);

        while ($row = pg_fetch_assoc($result)) {
            $country = $row[co_name];
            if ($row[count] > 0) {
                echo "['".$country."', ".round(($row[count]/$co_array[$country])*10000).", ".$row[count]."],\n          ";
            }
        }
      ?>
    ]);
    if (sorting != "[object Event]") {
        if (sorting) {
            dataBarCountry.sort([{column: 2,desc: true},{column: 1,desc: true}]);
        } else {
            dataBarCountry.sort([{column: 1,desc: true},{column: 2,desc: true}]);
        }
    }


    var optionsBarCountry = {
        series:{0:{targetAxisIndex:0},1:{targetAxisIndex:1}},
        vAxes: {
            0: {
                color: 'blue',
                baseline: 76.56
            },
            1: {
                color: 'red',
                logScale: true
            }
        },
        backgroundColor: 'none',
        chartArea: {width:"80%"},
        hAxis: { slantedTextAngle: 50}
    };

    var chartBarCountry = new google.visualization.ColumnChart(document.getElementById('chart_bar_country_div'));
    chartBarCountry.draw(dataBarCountry, optionsBarCountry);

}

function drawVisualization() {
    // Create and populate the data table.
    var dataObjects = new google.visualization.DataTable();
    dataObjects.addColumn('date', 'Date');
    dataObjects.addColumn('number', 'Objects');
    dataObjects.addColumn('number', 'Models');
    dataObjects.addColumn('number', 'Signs');


    dataObjects.addRows([
        [new Date(2008,6,1), 994057, 786, 0],
        [new Date(2008,10,15), 1038108, 1269, 573 ],
        [new Date(2008,12,5), 1038477, 1306, 679 ],
        [new Date(2009,1,7), 1036978, 1340, 723 ],
        [new Date(2009,3,6), 1113341, 1392, 723 ],
        [new Date(2009,6,6), 1113531, 1501, 723 ],
        [new Date(2009,11,4), 1115669, 1621, 967 ],
        [new Date(2010,3,9), 1117244, 1725, 968 ],
        [new Date(2010,11,3), 1120218, 1931, 1743 ],
        [new Date(2011,1,20), 1120390, 2009, 1743 ],
        [new Date(2011,4,12), 1121693, 2112, 1900 ],
        [new Date(2011,6,9), 1122199, 2213, 1974 ],
        [new Date(2011,11,1), 1122439, 2324, 1974 ],
        [new Date(2012,1,4), 1122980, 2390, 2013 ],
        [new Date(2012,1,15), 1123543, 2400, 2013 ],
        [new Date(2012,2,24), 1123673, 2434, 2051 ],
        [new Date(2012,5,4), 1123722, 2477, 2074 ],
        [new Date(2012,7,18), 1123988, 2523, 2074 ],
        [new Date(2012,7,26), 1124686, 2523, 2074 ],
        [new Date(2012,8,21), 1106060, 2605, 2074 ],
        [new Date(2012,8,22), 1106125, 2605, 2074 ],
        [new Date(2012,8,25), 1106276, 2617, 2074 ]
  ]);

  // Create and draw the visualization.
  new google.visualization.LineChart(document.getElementById('chart_objects_div')).
      draw(dataObjects, {
                    series:{0:{targetAxisIndex:0},1:{targetAxisIndex:1},2:{targetAxisIndex:1}},
                    vAxes: {
                        0: {
                            color: 'blue'
                        },
                        1: {
                            color: 'red',
                            logScale: true
                        }
                    },
                    pointSize: 5,
                    backgroundColor: 'none',
                    focusTarget: 'category'
                  }
          );
}

google.setOnLoadCallback(drawVisualization);
</script>

<h1>FlightGear Scenery Statistics</h1>
<?php
    connect_sphere_r();
    $result = pg_query("SELECT count(mo_id) AS count FROM fgs_models;");
    $row    = pg_fetch_assoc($result);
    $models = $row["count"];

    $result = pg_query("SELECT count(ob_id) AS count FROM fgs_objects;");
    $row    = pg_fetch_assoc($result);
    $objects= $row["count"];

    $result = pg_query("SELECT count(si_id) AS count FROM fgs_signs;");
    $row    = pg_fetch_assoc($result);
    $signs  = $row["count"];

echo "<p class=\"center\">The database currently contains <a href=\"models.php\">$models models</a> placed in the scenery as <a href=\"objects.php\">$objects seperate objects</a>, plus $signs taxiway signs.</p>\n";

?>
    <table class="float">
        <tr><th colspan="2">Objects by country</th></tr>
        <tr><td colspan="2">Click a country to remove it from the pie.</td></tr>
        <tr><td colspan="2"><div id="chart_pie_div" style="width: 100%; height: 250px;"></div></td></tr>
    </table>
    <table class="float">
        <tr><th colspan="2">Objects by author</th></tr>
        <tr><td colspan="2">Click an author to remove him from the pie.</td></tr>
        <tr><td colspan="2"><div id="chart_pie_authors_div" style="width: 100%; height: 250px;"></div></td></tr>
    </table>

    <div class="clear"></div><br/>

    <table>
        <tr><td colspan="2">
        <div style="float: right">
            <b>Show:</b>
            <ul>
                <li><a onclick="drawRegionsMap('auto','data1')">Object density</a></li>
                <li><a onclick="drawRegionsMap('auto','data2')">Absolute object count</a></li>
            </ul>
            <b>Zoom in to:</b>
            <ul>
                <li><a onclick="drawRegionsMap('world','auto')">Whole world</a></li>
                <li><a onclick="drawRegionsMap('005','auto')">South America</a></li>
                <li><a onclick="drawRegionsMap('013','auto')">Central America</a></li>
                <li><a onclick="drawRegionsMap('021','auto')">North America</a></li>
                <li><a onclick="drawRegionsMap('002','auto')">All of Africa</a></li>
                <li><a onclick="drawRegionsMap('017','auto')">Central Africa</a></li>
                <li><a onclick="drawRegionsMap('015','auto')">Northern Africa</a></li>
                <li><a onclick="drawRegionsMap('018','auto')">Southern Africa</a></li>
                <li><a onclick="drawRegionsMap('030','auto')">Eastern Asia</a></li>
                <li><a onclick="drawRegionsMap('034','auto')">Southern Asia</a></li>
                <li><a onclick="drawRegionsMap('035','auto')">Asia/Pacific region</a></li>
                <li><a onclick="drawRegionsMap('143','auto')">Central Asia</a></li>
                <li><a onclick="drawRegionsMap('145','auto')">Middle East</a></li>
                <li><a onclick="drawRegionsMap('151','auto')">Northern Asia</a></li>
                <li><a onclick="drawRegionsMap('154','auto')">Northern Europe</a></li>
                <li><a onclick="drawRegionsMap('155','auto')">Western Europe</a></li>
                <li><a onclick="drawRegionsMap('039','auto')">Southern Europe</a></li>
            </ul>
        </div>
        <div id="chart1_div" style="width: 80%; height: 500px;"></div>
        </td></tr>
    </table>

    <div class="clear"></div><br/>

    <table>
        <tr><td colspan="2">
        <div style="float: right">
            <b>Sort by:</b>
            <ul>
                <li><a onclick="drawBars(false)">Object density</a></li>
                <li><a onclick="drawBars(true)">Absolute object count</a></li>
            </ul>
        </div>
        <div id="chart_bar_country_div" style="width: 80%; height: 500px;"></div>
    </td></tr>
    </table>

    <div class="clear"></div><br/>

    <table>
        <tr><th colspan="2">Time evolution</th></tr>
        <tr><td colspan="2">
        <div id="chart_objects_div" style="width: 100%; height: 500px;"></div>
    </td></tr>
    </table>

    <div class="clear"></div>

<?php include 'inc/footer.php';?>
